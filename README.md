# Service d'Authentification

Ce service fournit une authentification compl√®te via OAuth (GitHub, Google) avec stockage des utilisateurs dans MongoDB.

## Fonctionnalit√©s

- üîê Authentification via GitHub et Google
- üîÑ Sessions persistantes avec cookies s√©curis√©s
- üìä Stockage des profils utilisateurs dans MongoDB
- üõ°Ô∏è S√©curit√© renforc√©e (headers, rate limiting, HTTPS en prod)
- üåê Compatible avec une architecture microservices

## Technologies utilis√©es

- Node.js & TypeScript
- Express.js
- Passport.js avec strat√©gies OAuth
- MongoDB (local ou Atlas)
- Mongoose

## Installation

1. Cloner le d√©p√¥t
```bash
git clone <url-du-repo>
cd authentication-service
```

2. Installer les d√©pendances
```bash
pnpm install
```

3. Configurer les variables d'environnement
```bash
cp .env.example .env
# √âditer le fichier .env avec vos propres valeurs
```

## Configuration

### Variables d'environnement

Le service n√©cessite les variables d'environnement suivantes dans le fichier `.env` :

```
# Server Configuration
PORT=3000
NODE_ENV=development

# Security
COOKIE_SECRET=your-secret-key-here

# Rate Limiting
RATE_LIMIT_WINDOW_MS=15
RATE_LIMIT_MAX=100

# OAuth Providers
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# URLs
CALLBACK_URL=http://localhost:3000/auth/callback
FRONTEND_URL=http://localhost:3000

# Database
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/auth-service?retryWrites=true&w=majority
```

### OAuth Configuration

Pour utiliser l'authentification OAuth :

1. **GitHub**
   - Cr√©er une OAuth App sur [GitHub Developer Settings](https://github.com/settings/developers)
   - URL de callback: `http://localhost:3000/auth/callback/github`

2. **Google**
   - Cr√©er un projet et des identifiants OAuth sur [Google Cloud Console](https://console.cloud.google.com/apis/credentials)
   - URI de redirection autoris√©s: `http://localhost:3000/auth/callback/google`

### Base de donn√©es

Le service utilise MongoDB pour stocker les profils utilisateurs :

- En d√©veloppement: MongoDB local ou Atlas
- En production: MongoDB Atlas recommand√©

## D√©marrage

```bash
# D√©veloppement
pnpm dev

# Production
pnpm build
pnpm start
```

## Routes API

### Authentification

- `GET /auth/github` - Initier l'authentification GitHub
- `GET /auth/google` - Initier l'authentification Google
- `GET /auth/callback/github` - Callback pour GitHub
- `GET /auth/callback/google` - Callback pour Google
- `GET /auth/logout` - D√©connexion
- `GET /auth/status` - V√©rifier l'√©tat d'authentification

### Profil utilisateur

- `GET /profile` - Obtenir le profil de l'utilisateur connect√©

## Structure du projet

```
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/             # Configuration (env, passport, database)
‚îÇ   ‚îú‚îÄ‚îÄ controllers/        # Contr√¥leurs de routes
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/        # Middlewares (s√©curit√©, erreurs)
‚îÇ   ‚îú‚îÄ‚îÄ models/             # Mod√®les Mongoose
‚îÇ   ‚îú‚îÄ‚îÄ routes/             # D√©finitions des routes
‚îÇ   ‚îú‚îÄ‚îÄ utils/              # Utilitaires
‚îÇ   ‚îî‚îÄ‚îÄ index.ts            # Point d'entr√©e
‚îú‚îÄ‚îÄ .env                    # Variables d'environnement
‚îî‚îÄ‚îÄ package.json            # D√©pendances et scripts
```

## Mod√®le utilisateur

Chaque utilisateur authentifi√© est stock√© avec la structure suivante :

```typescript
interface IUser {
  id: string;          // ID fourni par le provider (GitHub, Google)
  provider: string;    // 'github' ou 'google'
  displayName: string; // Nom d'affichage
  email: string;       // Email
  avatar?: string;     // URL de l'avatar
  createdAt: Date;     // Date de cr√©ation
  updatedAt: Date;     // Date de derni√®re mise √† jour
}
```

## S√©curit√©

Le service impl√©mente plusieurs mesures de s√©curit√© :

- Headers de s√©curit√© via Helmet
- Protection contre les attaques par force brute (rate limiting)
- Cookies httpOnly et secure (en prod)
- Redirection HTTPS en production
- Validation du Content-Type

## Int√©gration avec le frontend

1. Rediriger l'utilisateur vers `/auth/github` ou `/auth/google` pour l'authentification
2. Apr√®s authentification, l'utilisateur est redirig√© vers l'URL sp√©cifi√©e dans `FRONTEND_URL`
3. Le frontend peut alors appeler `/profile` pour obtenir les informations de l'utilisateur connect√©

## D√©veloppement

```bash
# Lancer en mode d√©veloppement avec rechargement √† chaud
pnpm dev

# Linter
pnpm lint

# Tests
pnpm test
```

## Production

Pour le d√©ploiement en production :

1. Configurer les variables d'environnement pour la production
2. Utiliser un serveur MongoDB s√©curis√© (Atlas recommand√©)
3. D√©finir `NODE_ENV=production`
4. Utiliser un proxy inverse (Nginx, etc.) pour g√©rer HTTPS

## Licence

MIT 